<?xml version='1.0'?>

<robot name="rerassor" xmlns:xacro="http://www.ros.org/wiki/xacro">

	<xacro:property name="robot_scale" value="0.2"/>

	<xacro:property name="cameraSize" value="0.01"/>
	<xacro:property name="cameraMass" value="0.1"/>
    <xacro:include filename="$(find rover_description)/urdf/macros.xacro"/>
	<xacro:include filename="$(find rover_description)/urdf/materials.xacro"/>

	<!--Camera x y z values guesstimated to align with the mast-->
	 <joint name="camera_optical_joint" type="fixed">
		<origin xyz="1.8 0 3.7" rpy="0 0 0" />
        <parent link="base_link" />
        <child link="camera_link_optical" />
    </joint>

    <link name="camera_link_optical"></link>
	
	<!-- TODO: FIX THIS FOR ZED MINI SPECS -->
	<gazebo reference="camera_link_optical">
        <sensor type="depth" name="rgbd_camera">
			<always_on>true</always_on>
            <update_rate>30</update_rate>
            <visualize>true</visualize>
			<topic>camera</topic>
            <camera name="cam">
                <horizontal_fov>1.29154</horizontal_fov>
                <image>
					<width>640</width>
					<height>480</height>
                    <format>R8G8B8</format>
                </image>
				<clip>
					<near>0.105</near>
					<far>100</far>
				</clip>
            </camera>
        </sensor>
    </gazebo>

	<!-- End camera -->

	<!--Tags below represent robot links and joints only-->
	<link name='base_link'>
		<pose>0 0 0 0 0 0</pose>
	</link>

	<link name='body'>
		<pose>0 0 0 0 0 0</pose>
		<inertial>
			<mass value="15.0"/>
			<origin xyz="0 0 0" rpy=" 0 0 0"/>
			<inertia ixx="16.67" ixy="0" ixz="0" iyy="16.67" iyz="0" izz="16.67" />
		</inertial>
		<collision name='collision'>
			<origin xyz="0 0 0" rpy=" 0 0 0"/>
			<geometry>
       			<mesh filename="file://$(find rover_description)/meshes/base_unit.dae" scale="0.01 0.01 0.01"></mesh>
			</geometry>
		</collision>
		<visual name='base_link_visual'>
			<origin xyz="0 0 0" rpy=" 0 0 0"/>
			<geometry>
        		<mesh filename="file://$(find rover_description)/meshes/base_unit.dae" scale="0.01 0.01 0.01"></mesh>
			</geometry>
		</visual>
	</link>
    
    <gazebo reference="base_link">
		<material>Gazebo/ZincYellow</material>        
		<selfCollide>0</selfCollide>
    </gazebo>
	
    <joint name="body_joint" type="fixed">
		<axis xyz="0 0 0"/>
		<origin xyz="0 0 1.0" rpy="0 0 0"/>
		<parent link="base_link"/>
		<child link="body"/>
	</joint>


	<!-- Define wheels directly (formerly macros) -->
	<!-- Left Front Wheel -->
    <!---->
	<link name="left_wheel_front_link">
		<visual name="left_wheel_front_visual">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
		</visual>
		<collision name="collision">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
			<surface>
				<friction>
					<mu>0.5</mu>
					<mu2>0.5</mu2>
				</friction>
			</surface>
		</collision>
		 <inertial>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<mass value="5"/>
			<inertia ixx="0.329" ixy="0" ixz="0" iyy="0.329" iyz="0" izz="0.625"/>
		</inertial>
	</link>

	<joint name="left_wheel_front_joint" type="continuous">
		<origin xyz="1.5 1.2 0.2" rpy="${pi/2} 0 0"/>
		<child link="left_wheel_front_link"/>
		<parent link="body"/>
		<axis xyz="0 0 -1"/>
		<dynamics damping="0.5"/>
	</joint>

	<transmission name="left_front_trans">
		<type>transmission_interface/SimpleTransmission</type>
		<joint           name="left_wheel_front_joint">
			<hardwareInterface>velocity</hardwareInterface>
		</joint>
		<actuator name="lf_act">
			<hardwareInterface>velocity</hardwareInterface>
			<mechanicalReduction>1.0</mechanicalReduction>
		</actuator>
	</transmission>


	<gazebo reference="left_wheel_front_link">
		<selfCollide>1</selfCollide>
		<mu1 value="0.5"/>
		<mu2 value="0.5"/>
		<kp value="10000000.0" />
		<kd value="1.0" />
		<fdir1 value="1 0 0"/>
	</gazebo>


	<link name="right_wheel_front_link">
		<visual name="right_wheel_front_visual">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
		</visual>
		<collision name="collision">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
			<surface>
				<friction>
					<mu>0.5</mu>
					<mu2>0.5</mu2>
				</friction>
			</surface>
		</collision>
		<inertial>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<mass value="5"/>
			<inertia ixx="0.329" ixy="0" ixz="0" iyy="0.329" iyz="0" izz="0.625"/>
		</inertial>
	</link>

	<joint name="right_wheel_front_joint" type="continuous">
		<origin xyz="1.5 -1.2 0.2" rpy="${3 * pi / 2} 0 0"/>
		<child link="right_wheel_front_link"/>
		<parent link="body"/>
		<axis xyz="0 0 1"/>
		<dynamics damping="0.5"/>
	</joint>

	<transmission name="right_front_trans">
		<type>transmission_interface/SimpleTransmission</type>
		<joint           name="right_wheel_front_joint">
			<hardwareInterface>velocity</hardwareInterface>
		</joint>
		<actuator name="lf_act">
			<hardwareInterface>velocity</hardwareInterface>
			<mechanicalReduction>1.0</mechanicalReduction>
		</actuator>
	</transmission>

	<gazebo reference="right_wheel_front_link">
		<selfCollide>1</selfCollide>
		<mu1 value="0.5"/>
		<mu2 value="0.5"/>
		<kp value="10000000.0" />
		<kd value="1.0" />
		<fdir1 value="1 0 0"/>
	</gazebo>


	<link name="right_wheel_back_link">
		<visual name="right_back_front_visual">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
		</visual>
		<collision name="collision">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
			<surface>
				<friction>
					<mu>0.5</mu>
					<mu2>0.5</mu2>
				</friction>
			</surface>
		</collision>
		<inertial>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<mass value="5"/>
			<inertia ixx="0.329" ixy="0" ixz="0" iyy="0.329" iyz="0" izz="0.625"/>
		</inertial>
	</link>

	<joint name="right_wheel_back_joint" type="continuous">
		<origin xyz="-1.5 -1.2 0.2" rpy="${3 * pi / 2} 0 0"/>
		<child link="right_wheel_back_link"/>
		<parent link="body"/>
		<axis xyz="0 0 1"/>
		<dynamics damping="0.5"/>
	</joint>

	<transmission name="right_back_trans">
		<type>transmission_interface/SimpleTransmission</type>
		<joint           name="right_wheel_back_joint">
			<hardwareInterface>velocity</hardwareInterface>
		</joint>
		<actuator name="lf_act">
			<hardwareInterface>velocity</hardwareInterface>
			<mechanicalReduction>1.0</mechanicalReduction>
		</actuator>
	</transmission>

	<gazebo reference="right_wheel_back_link">
		<selfCollide>1</selfCollide>
		<mu1 value="0.5"/>
		<mu2 value="0.5"/>
		<kp value="10000000.0" />
		<kd value="1.0" />
		<fdir1 value="1 0 0"/>
	</gazebo>


	<link name="left_wheel_back_link">
		<visual name="left_back_front_visual">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
		</visual>
		<collision name="collision">
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<geometry>
				<mesh filename="file://$(find rover_description)/meshes/wheel.dae" scale="0.01 0.01 0.01"/>
			</geometry>
			<surface>
				<friction>
					<mu>0.5</mu>
					<mu2>0.5</mu2>
				</friction>
			</surface>
		</collision>
		<inertial>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<mass value="5"/>
			<inertia ixx="0.329" ixy="0" ixz="0" iyy="0.329" iyz="0" izz="0.625"/>
		</inertial>
	</link>

	<joint name="left_wheel_back_joint" type="continuous">
		<origin xyz="-1.5 1.2 0.2" rpy="${pi/2} 0 0"/>
		<child link="left_wheel_back_link"/>
		<parent link="body"/>
		<axis xyz="0 0 -1"/>
		<dynamics damping="0.5"/>
	</joint>

	<transmission name="left_back_trans">
		<type>transmission_interface/SimpleTransmission</type>
		<joint           name="left_wheel_back_joint">
			<hardwareInterface>velocity</hardwareInterface>
		</joint>
		<actuator name="lf_act">
			<hardwareInterface>velocity</hardwareInterface>
			<mechanicalReduction>1.0</mechanicalReduction>
		</actuator>
	</transmission>

	<gazebo reference="left_wheel_back_link">
		<selfCollide>1</selfCollide>
		<mu1 value="0.5"/>
		<mu2 value="0.5"/>
		<kp value="10000000.0" />
		<kd value="1.0" />
		<fdir1 value="1 0 0"/>
	</gazebo>


	<!-- Similar expansions for left_wheel_back and right_wheel_back -->

	<!-- ROS2 Control -->
	<ros2_control name="GazeboSystem" type="system">
		<hardware>
			<plugin>gz_ros2_control/GazeboSimSystem</plugin>
		</hardware>

		<joint name="left_wheel_front_joint">
			<command_interface name="velocity">
				<param name="min">-10</param>
				<param name="max">10</param>
			</command_interface>
			<state_interface name="position"/>
			<state_interface name="velocity"/>
		</joint>

		<joint name="right_wheel_front_joint">
			<command_interface name="velocity">
				<param name="min">-10</param>
				<param name="max">10</param>
			</command_interface>
			<state_interface name="position"/>
			<state_interface name="velocity"/>
		</joint>

		<joint name="right_wheel_back_joint">
			<command_interface name="velocity">
				<param name="min">-10</param>
				<param name="max">10</param>
			</command_interface>
			<state_interface name="position"/>
			<state_interface name="velocity"/>
		</joint>

		<joint name="left_wheel_back_joint">
			<command_interface name="velocity">
				<param name="min">-10</param>
				<param name="max">10</param>
			</command_interface>
			<state_interface name="position"/>
			<state_interface name="velocity"/>
		</joint>
		<!-- Similar entries for the other wheel joints -->
	</ros2_control>

	<gazebo>
		<plugin filename="libgz_ros2_control-system.so" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
			<parameters>$(find rover_control)/controllers/diff_cont.yaml</parameters>
		</plugin>
	</gazebo>
</robot>
